import {createMessageObject} from './helpers';

describe('redux-module-activity: helpers', () => {
  /**
   * All of the message conversion tests.
   * Not using snapshots because these tests need to be very specific.
   */
  describe('#createMessageObject', () => {
    it('should send plain text without converting', () => {
      const text = 'Plain text coming through!';
      const {content, displayName} = createMessageObject(text);
      expect(content).toEqual(undefined);
      expect(displayName).toMatchSnapshot();
    });

    it('should send plain text without converting special characters', () => {
      const text = 'I\'m "not" finished!';
      const {content, displayName} = createMessageObject(text);
      expect(content).toMatchSnapshot();
      expect(displayName).toMatchSnapshot();
    });

    it('should convert a url to html link', () => {
      const text = 'https://www.cisco.com';
      const html = '<a href="https://www.cisco.com">https://www.cisco.com</a>';
      const {content, displayName} = createMessageObject(text);
      expect(content).toEqual(html);
      expect(displayName).toEqual(text);
    });

    it('should convert mentions properly', () => {
      const text = '@{Test User}|7d340ace-adad-43f2-adad-f88694b4024f| hey!';
      const {content, displayName} = createMessageObject(text);
      expect(content).toMatchSnapshot();
      expect(displayName).toMatchSnapshot();
    });

    it('should convert markdown properly', () => {
      const text = '[url](http://mylink.site) Check this **out**!';
      const {content, displayName} = createMessageObject(text);
      expect(content).toMatchSnapshot();
      expect(displayName).toMatchSnapshot();
    });

    it('should convert mentions and markdown properly', () => {
      const text = '@{Test User}|7d340ace-adad-43f2-adad-f88694b4024f| hey! [this](http://url.me) *thing*';
      const plainText = 'Test User hey! this thing';
      const html = '<spark-mention data-object-type="person" data-object-id="7d340ace-adad-43f2-adad-f88694b4024f">Test User</spark-mention> hey! <a href="http://url.me">this</a> <em>thing</em>';
      const {content, displayName} = createMessageObject(text);
      expect(content).toEqual(html);
      expect(displayName).toEqual(plainText);
    });

    it('should not convert html submitted via plain text', () => {
      const text = '<html><pre><p></pre><data data-api>';
      const {content, displayName} = createMessageObject(text);
      expect(content).toMatchSnapshot();
      expect(displayName).toMatchSnapshot();
    });

    it('should not remove html blocks from markdown code blocks', () => {
      const text = '```\n<b>bold</b>\n```';
      const {content, displayName} = createMessageObject(text);
      expect(content).toMatchSnapshot();
      expect(displayName).toMatchSnapshot();
    });

    it('should convert mentions and markdown with html properly', () => {
      const text = '@{Test User}|7d340ace-adad-43f2-adad-f88694b4024f| hey! [this](http://url.me) *thing* `<b>bold</b>`';
      const {content, displayName} = createMessageObject(text);
      expect(content).toMatchSnapshot();
      expect(displayName).toMatchSnapshot();
    });
  });
});
